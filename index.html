<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>TORNEO DI BILIARDINO</title>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet">
  <style>
    body { font-family: Arial, sans-serif; background-color: #f1f5e3; margin: 0; padding: 0; }
    header { background-color: #0e7546; color: white; text-align: center; padding: 1.5rem 0; font-family: 'Bebas Neue', sans-serif; font-size: 4.5rem; letter-spacing: 2px; }
    .container { display: flex; flex-direction: column; gap: 20px; padding: 20px; max-width: 1200px; margin: auto; }
    #matches-container, .standings { flex: 1; background: #fff; border-radius: 8px; padding: 15px; overflow-y: auto; }
    .standings h2, #matches-container h2 { text-align: center; text-transform: uppercase; }
    .match { display: flex; align-items: center; justify-content: space-between; background: #fff; padding: 10px 15px; border: 1px solid #ccc; border-radius: 8px; margin-bottom: 10px; transition: background 0.3s; }
    .match.played { background: #d2f8d2; }
    .match.played .player-names { color: #555; }
    .hidden { display: none !important; }
    .score-input { width: 3rem; text-align: center; font-size: 1rem; }
    .score-section { display: flex; align-items: center; gap: 5px; }
    .filter-buttons { display: flex; flex-wrap: wrap; gap: 10px; margin: 10px 0; justify-content: center; margin-bottom: 30px; }
    .filter-btn { padding: 5px 10px; background: #ccc; border: none; border-radius: 5px; cursor: pointer; }
    .filter-btn.active { background: #a3d9a5; }
    table { width: 100%; border-collapse: collapse; }
    th, td { border: 1px solid #ccc; padding: 10px; text-align: center; }
    th { background-color: #e7f5e7; color: #0e7546; }
    .submit-btn, .edit-btn, #save-button { background: #0e7546; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; }
    .edit-btn { background-color: #66bb6a; }
    #save-button { background: #0e7546; display: block; margin: 20px auto 30px; padding: 8px 15px; font-size: 0.8rem; }
    .gold { background-color: #fff8dc !important; }
    .silver { background-color: #f5f5f5 !important; }
    .bronze { background-color: #fcebd0 !important; }
    @media (max-width: 768px) { .row { flex-direction: column; } }
  </style>
</head>
<body>
  <header>TORNEO DI BILIARDINO</header>
  
  <div class="container">
    <div class="standings">
      <h2>Classifica</h2>
      <table>
        <thead>
          <tr>
            <th>Posizione</th><th>Giocatore</th><th>Giocate</th><th>Vinte</th><th>% Vittorie</th><th>Segnati</th><th>Subiti</th>
          </tr>
        </thead>
        <tbody id="leaderboard"></tbody>
      </table>
    </div>

    <div id="matches-container">
      <h2>Partite</h2>
      <div class="filter-buttons" id="player-filters"></div>
      <div id="matches"></div>
    </div>
  </div>

  <button id="save-button" onclick="saveScoresToGist()">SALVA PUNTEGGI ONLINE</button>

  <script>
    // Configurazione Gist (CON I TUOI DATI)
    const GIST_ID = "488349475ea8d1bc31ac5ea037bda43e";
    const GIST_TOKEN = "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";

    // Variabili globali
    let savedScores = {};
    const players = ["CHIARA", "FRENKIE", "IRE", "KLM", "LUCA", "TEO"];
    let stats = Object.fromEntries(players.map(p => [p, {
      points: 0, played: 0, won: 0, goalsFor: 0, goalsAgainst: 0
    }]));

    const matches = [
      ["CHIARA", "FRENKIE", "IRE", "KLM"], ["CHIARA", "FRENKIE", "IRE", "LUCA"], ["CHIARA", "FRENKIE", "IRE", "TEO"],
      // ... (mantieni tutte le altre partite come nel tuo codice originale) ...
      ["IRE", "KLM", "LUCA", "TEO"], ["IRE", "LUCA", "KLM", "TEO"], ["IRE", "TEO", "KLM", "LUCA"]
    ].map(([a1, a2, b1, b2]) => [[a1, a2], [b1, b2]]);

    const activeFilters = new Set();

    // Funzione per salvare su Gist
    async function saveScoresToGist() {
      try {
        const response = await fetch(`https://api.github.com/gists/${GIST_ID}`, {
          method: "PATCH",
          headers: {
            "Authorization": `token ${GIST_TOKEN}`,
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            files: {
              "biliardino-scores.json": {
                content: JSON.stringify(savedScores)
              }
            }
          })
        });

        if (response.ok) {
          alert("Punteggi salvati con successo su GitHub Gist!");
        } else {
          alert("Errore nel salvataggio: " + (await response.text()));
        }
      } catch (error) {
        alert("Errore di connessione: " + error);
      }
    }

    // Funzione per caricare i punteggi
    async function loadScoresFromGist() {
      try {
        const response = await fetch(`https://api.github.com/gists/${GIST_ID}`);
        const gistData = await response.json();
        const scoresJson = gistData.files["biliardino-scores.json"].content;
        savedScores = JSON.parse(scoresJson);
        calculateAllStats();
        renderMatches();
      } catch (error) {
        console.log("Nessun punteggio trovato, inizializzo nuovo torneo.");
        savedScores = {};
      }
    }

    // Funzioni esistenti (modificate per salvare automaticamente su Gist)
    function submitScore(c) {
      const e = document.getElementById(`s1-${c}`);
      const t = document.getElementById(`s2-${c}`);
      const l = parseInt(e.value);
      const s = parseInt(t.value);
      
      if(!isNaN(l) && !isNaN(s)) {
        savedScores[c] = {s1: l, s2: s};
        saveScoresToGist(); // Salva automaticamente su Gist
        calculateAllStats();
        renderMatches();
        filterMatches();
      }
    }

    // ... (mantieni tutte le altre funzioni come renderMatches, calculateAllStats, etc.) ...

    // Inizializzazione
    loadScoresFromGist();
    renderFilters();
    renderMatches();
    calculateAllStats();
    filterMatches();
  </script>
</body>
</html>
